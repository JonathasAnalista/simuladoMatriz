<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pagamento aprovado - Legmaster</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,Helvetica,sans-serif;margin:0;background:#f6fff7;color:#0f5132}
    .wrap{max-width:760px;margin:0 auto;padding:32px}
    .card{background:#fff;border:1px solid #badbcc;border-radius:12px;padding:24px;box-shadow:0 6px 16px rgba(0,0,0,.06)}
    h1{margin:0 0 10px 0;font-size:22px}
    p{margin:6px 0;font-size:15px;color:#1b4332}
    .ok{display:inline-flex;align-items:center;gap:8px;color:#0f5132;background:#d1e7dd;border:1px solid #badbcc;border-radius:9999px;padding:6px 12px;font-weight:700}
    .actions{margin-top:16px;display:flex;gap:10px;flex-wrap:wrap}
    a.btn{display:inline-block;background:#2E7D32;color:#fff;text-decoration:none;padding:10px 14px;border-radius:10px;font-weight:700}
  </style>
  <script>
    // Exibe algumas infos da URL se existirem
    function getParam(k){return new URLSearchParams(location.search).get(k)}
    document.addEventListener('DOMContentLoaded',()=>{
      const id = getParam('payment_id') || getParam('collection_id') || '';
      const el = document.getElementById('pid');
      if (id && el) el.textContent = id;
    });
  </script>
  <!-- Firebase + config para confirmar liberação automática -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
  <script src="/js/config.js"></script>
  <script>
    (function(){
      function emailDocId(email){ return String(email||'').trim().toLowerCase().replace(/[.@]/g,'_'); }
      function getEmail(){ try{ return (JSON.parse(localStorage.getItem('usuarioLogado')||'{}').email||'').toLowerCase(); }catch{return ''} }
      function setMsg(t){ var p=document.createElement('p'); p.id='okmsg'; p.style.color='#2E7D32'; p.style.fontWeight='700'; p.textContent=t; var card=document.querySelector('.card'); if(card){ card.insertBefore(p, card.children[2]); } }
      document.addEventListener('DOMContentLoaded', function(){
        try{ if (window.LEGMASTER_CONFIG && !window.firebaseAppInitialized){ firebase.initializeApp(window.LEGMASTER_CONFIG.FIREBASE_CONFIG); window.firebaseAppInitialized=true; } }catch(e){}
        var email = getEmail(); if(!email || !window.firebase || !firebase.firestore) return;
        var id = emailDocId(email);
        try {
          firebase.firestore().collection('liberacoes').doc(id).onSnapshot(function(snap){
            var d = snap && snap.data ? snap.data() : null; var plano = (d && d.plano)||'';
            if (String(plano).toLowerCase()==='pro'){
              if (!document.getElementById('okmsg')) setMsg('Pagamento aprovado — versão completa liberada!');
            }
          });
        } catch(e){}
      });
    })();
  </script>
  <meta name="robots" content="noindex" />
  <link rel="icon" href="/icons/icon-192.png" />
  <meta name="theme-color" content="#2E7D32" />
  <link rel="manifest" href="/manifest.json" />
  <meta http-equiv="Cache-Control" content="no-store" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  
</head>
<body>
  <div class="wrap">
    <div class="card">
      <span class="ok">✅ Pagamento aprovado</span>
      <h1>Obrigado! Seu acesso PRO será liberado.</h1>
      <p>Se ainda não liberou automaticamente, aguarde alguns instantes. Você também pode atualizar a página inicial.</p>
      <p id="pid" style="font-family:monospace;color:#495057"></p>
      <div class="actions">
        <a class="btn" href="/index.html">Voltar para a página inicial</a>
      </div>
    </div>
  </div>
</body>
</html>
